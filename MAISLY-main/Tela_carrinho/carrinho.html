<!DOCTYPE html>
<html lang="pt">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MAISLY</title>
    <link rel="stylesheet" href="carrinho.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.13.1/font/bootstrap-icons.min.css">
</head>
<body theme = light>
    <header>
        <div id="parte1">
            <a href="../Tela_inicio/inicio.html">
                <img src="../imagem/logo.png" height="50" width="180">
            </a>
            <div id="icones">
                <input id="pesquisar" type="text" placeholder="Pesquisar">
                
                
                <button class="botaotype" onclick="abrirCurtido()">
                    <img src="../imagem/coracao.png">
                </button>

                <button class="botaotype especial">
                    <img src="../imagem/carrinho.png" onclick="abrirCarrinho()">
                </button>

                <a href="../Tela_perfil/perfil.html">
                    <button class="botaotype">
                        <img src="../imagem/pessoalogin.png">
                    </button>
                </a>
            </div>
        </a>

        </div>
        <div id="parte2"> 
            <button onclick="openMenu()" class="sidebar-icon">
                <i id="icon" class="bi bi-list"></i>
                <span>Menu</span>
            </button>
            <div class="menu-temas">
                <p class="p"> <img src="../imagem/ferramenta.png" id="iconestl"> Temas</p>
                <div class="temas"> 
                <p id="light">Light</p>
                <p id="dark">Dark</p>
                <p id="baixa">Baixa visão</p>
                </div>
            </div>
        <p class="p"  id="acesibili">  <img src="../imagem/acesibili.png" id="iconestl">Acessibilidade</p>

        <a href="../tela_ajuda/tela_ajuda.html" class="p">
            <img src="../imagem/ajudasemfundo.png" id="iconestl">
            Ajuda
        </a>

    </div>
    </header>

    <nav id="menutenis">
        <div class="menu">
            <a href="../Tela_produto01/produto1.html"id="block">
                <div id="navtenis">
                    <img src="../imagem/tenis0.jpeg" alt="">
                    <p>Promoções</p>
                </div>
            </a>
            <a href="../Tela_produto02/produto2.html"id="block">
                <div id="navtenis">
                    <img src="../imagem/tenis1.jpeg" alt="">
                    <p>Masculino</p>
                </div>
            </a>
            <a href="../Tela_produto03/produto3.html"id="block">
                <div id="navtenis">
                    <img src="../imagem/tenis2.jpeg" alt="">
                    <p>Feminino</p>
                </div>
            </a>
            <a href="../Tela_produto04/produto4.html"id="block">
                <div id="navtenis">
                    <img src="../imagem/tenis3.jpeg" alt="">
                    <p>Infantil</p>
                </div>
            </a>
            <a href="../Tela_produto05/produto5.html"id="block">
                <div id="navtenis">
                    <img src="../imagem/tenis4.jpeg" alt="">
                    <p>Social</p>
                </div>
            </a>
            <a href="../Tela_produto06/produto6.html"id="block">
                <div id="navtenis">
                    <img src="../imagem/tenis5.jpeg" alt="">
                    <p>Casual</p>
                </div>
            </a>
            <a href="../Tela_produto07/produto7.html"id="block">
                <div id="navtenis">
                    <img src="../imagem/tenis6.jpeg" alt="">
                    <p>Esportivo</p>
                </div>
            </a>
            <a href="../Tela_produto08/produto8.html"id="block">
                <div id="navtenis">
                    <img src="../imagem/tenis7.jpeg" alt="">
                    <p>Sneaker</p>
                </div>
            </a>
        </div>
        <div class="sidebar">
            <a href="../Tela_produto01/produto1.html"><p>Promoções</p></a>
            <a href="../Tela_produto02/produto2.html"><p>Masculino</p></a>
            <a href="../Tela_produto03/produto3.html"><p>Feminino</p></a>
            <a href="../Tela_produto04/produto4.html"><p>Infantil</p></a>
            <a href="../Tela_produto05/produto5.html"><p>Social</p></a>
            <a href="../Tela_produto06/produto6.html"><p>Casual</p></a>
            <a href="../Tela_produto07/produto7.html"><p>Esportivo</p></a>
            <a href="../Tela_produto08/produto8.html"><p>Sneaker</p></a>
        </div>
    </nav>
    <section> 
        <div class="container">
            <div class="corpo1">
                <div class="nav">
                    <p>Seu carrinho</p>
                </div>
                <div id="lista-carrinho"></div>
            </div>
            
            <div class="resumo1">
                <div class="nav">
                    <p>Resumo do pedido</p>
                </div>
                <div class="resumoebotao">
                    <div class="resumo">
                        <div class="produtos" id="resumo-produtos"></div>
                        <div class="info">
                            <p>Preço de varejo:</p>
                            <p class="preco">R$ 277,00</p>
                        </div>
                        <div class="info2">
                            <p>Subtotal   (1 item )</p>
                        </div>
                        <div class="info3">
                            <p>______________</p>
                            <div class="info4">
                                <p>Valor total:</p>
                                <p class="preco">R$ 277,00</p>
                            </div>

                        </div>
                        <div class="finalizard">
                            <button class="finalizar" onclick="finalizarCompra()">
                                Finalizar compra
                            </button>
                        </div>
                        </div>
                        <div class="button">
                            <button class="addproduto">
                                    <img src="../imagem/adicionarcarrinho.png" alt="" class="icn">
                                    <a href="../Tela_produto01/produto1.html">Adicionar produto</a>
                            </button>
                        </div>
                    </div>

                </div>
                </div>
        </div>
    </section>
    <script>
        // Aplica o tema
        const temaSalvo = localStorage.getItem('tema');
        if (temaSalvo) {
            document.body.setAttribute('theme', temaSalvo);
        }
    
        function aplicarTema(tema) {
            document.body.setAttribute('theme', tema);
            localStorage.setItem('tema', tema);
        }

        document.getElementById('dark').addEventListener('click', () => aplicarTema('dark'));
        document.getElementById('light').addEventListener('click', () => aplicarTema('light'));
        document.getElementById('baixa').addEventListener('click', () => aplicarTema('baixa'));

        // Função para abrir curtidos (cheio e vazio)
        function abrirCurtido() {
            let curtido = JSON.parse(localStorage.getItem('curtido')) || [];
            if (curtido.length > 0) {
                window.location.href = '../Tela_curtido/curtidos2.html';
            } else {
                window.location.href = '../Tela_curtidovazio/curtidovazio.html';
            }
        }

        // Função abir sidebar
        function openMenu() {
            const menu = document.querySelector(".sidebar");
            const icon = document.getElementById("icon");

            menu.classList.toggle("open");

            if (menu.classList.contains("open")) {
                icon.classList.remove("bi-list");
                icon.classList.add("bi-x-lg");
            } else {
                icon.classList.remove("bi-x-lg");
                icon.classList.add("bi-list");
            }
        }

        let carrinho = JSON.parse(localStorage.getItem("carrinho")) || [];
        const lista = document.getElementById("lista-carrinho");

        // se não tiver nada, volta pro carrinho vazio
        if (carrinho.length === 0) {
            window.location.href = "../Tela_carrinhovazio/carrinhovazio.html";
        }

        //pra saber o valor de cada produto , pq pd aumentar em razão da quantidade de produtos iguais adicionados
        function precoTotal(produto) {
            return produto.preco * produto.qtd;
        }

        //sort reorganiza a lista e o - fa vir primeiro o de preço maior
        function ordenarCarrinhoPorPreco() {
            carrinho.sort((a, b) => {
                return precoTotal(b) - precoTotal(a);
            });
        }


        // quando algo for adcionado pro carrinho
        function renderizarCarrinho() {

            ordenarCarrinhoPorPreco(); //sempre q renderizar o carrinho já vem na ordem

            lista.innerHTML = carrinho.map((p, index) => `
            <div class="corpo">
                <div class="produto">
                    <img src="${p.img}" alt="imagem indisponível">
                </div>

                <div class="infoproduto">
                    <div class="geral">
                        <p>${p.nome}</p>
                        <br>
                        <p>Tamanho: ${p.tamanho ?? '-'}</p>
                    </div>

                    <div class="especifico">
                        <div class="quantidade">
                            <p class="qntd">Quantidade</p>

                            <div class="quantidade_num">
                                <button class="btn-qtd" onclick="alterarQtd(${index}, -1)">−</button>

                                <div class="num">
                                    <p>${p.qtd}</p>
                                </div>

                                <button class="btn-qtd" onclick="alterarQtd(${index}, 1)">+</button>
                            </div>
                        </div>

                        <div class="valor">
                            <p>____________</p>
                            <div class="valor_num">
                                <p>R$ ${(p.preco * p.qtd).toFixed(2)}</p>

                                <div class="icones-valor">
                                    <div class="lixinho">
                                        <img src="../imagem/lixinho.png"
                                            onclick="removerDoCarrinho(${index})">
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        `).join('');

        atualizarResumo();
    }

        // atualiza o resumo dos produtos la embaixo
        function atualizarResumo() {
            const total = carrinho.reduce(
                (soma, p) => soma + p.preco * p.qtd, 0
            );

            const totalItens = carrinho.reduce(
                (soma, p) => soma + p.qtd, 0
            );

            document.querySelectorAll('.preco').forEach(el => {
                el.innerText = `R$ ${total.toFixed(2)}`;
            });

            document.querySelector('.info2 p').innerText =
                `Subtotal (${totalItens} item(ns))`;

            const resumoProdutos = document.getElementById('resumo-produtos');
            resumoProdutos.innerHTML = carrinho.map(p => `
                <img src="${p.img}" alt="${p.nome}">
            `).join('');
        }

        // muda a quantidade dos produtos se clicar na setinha
        function alterarQtd(index, valor) {
            carrinho[index].qtd += valor;

            if (carrinho[index].qtd <= 0) {
                carrinho.splice(index, 1);
            }

            localStorage.setItem("carrinho", JSON.stringify(carrinho));

            if (carrinho.length === 0) {
                window.location.href = "../Tela_carrinhovazio/carrinhovazio.html";
                return;
            }

            renderizarCarrinho();
        }

        // clica na lixeirinha pra tirar do carrinho
        function removerDoCarrinho(index) {
            carrinho.splice(index, 1);
            localStorage.setItem("carrinho", JSON.stringify(carrinho));

            if (carrinho.length === 0) {
                window.location.href = "../Tela_carrinhovazio/carrinhovazio.html";
                return;
            }

            renderizarCarrinho();
        }

        // finaliza a comprra e esvazia o carrinho
        function finalizarCompra() {
  window.location.href = "../Tela_confirmacao/confirmacao.html";
}


        renderizarCarrinho();
    </script>
</body>
</html>